<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Skomorokha Editor</title>
    <style>
        :root { --primary: #ff9800; --secondary: #fff3e0; --gold: #ffeb3b; --green: #4caf50; --red: #f44336; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Comic Sans MS', 'Arial', sans-serif; }
        canvas { display: block; touch-action: none; }
        
        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); display: flex;
            flex-direction: column; justify-content: center; align-items: center; z-index: 2000;
            color: white; text-align: center; padding: 20px; box-sizing: border-box;
        }
        .card {
            background: white; color: #333; padding: 25px; border-radius: 30px;
            max-width: 500px; width: 95%; border: 6px solid var(--primary);
            position: relative; max-height: 90vh; overflow-y: auto;
        }
        .btn {
            background: var(--primary); color: white; border: none; padding: 12px 30px;
            font-size: 20px; font-weight: bold; border-radius: 50px; cursor: pointer;
            margin-top: 15px; transition: 0.3s; box-shadow: 0 4px 0 #e65100;
        }
        
        /* Editor UI */
        #editor-overlay { display: none; z-index: 4000; }
        .editor-section { margin-bottom: 20px; text-align: left; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .editor-section h3 { margin: 0 0 10px 0; color: var(--primary); font-size: 18px; }
        .editor-group { margin-bottom: 10px; }
        .editor-group label { display: block; font-size: 14px; font-weight: bold; margin-bottom: 4px; color: #555; }
        .editor-group input, .editor-group textarea { 
            width: 100%; padding: 8px; border: 2px solid #ddd; border-radius: 8px; 
            box-sizing: border-box; font-family: sans-serif; 
        }

        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; pointer-events: none; padding: 15px; box-sizing: border-box; color: white; z-index: 1000; }
        .top-right { position: absolute; top: 20px; right: 20px; pointer-events: auto; }
        #editor-toggle-btn { background: #333; color: white; border: 2px solid white; padding: 8px 15px; border-radius: 20px; cursor: pointer; }
        
        .indicator-box { background: rgba(0,0,0,0.7); padding: 8px 15px; border-radius: 20px; border: 3px solid var(--primary); font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>

<div id="editor-overlay" class="overlay">
    <div class="card">
        <h2>‚öôÔ∏è –†–µ–¥–∞–∫—Ç–æ—Ä –ò–≥—Ä—ã</h2>
        
        <div class="editor-section">
            <h3>1. –ü–µ—Ä—Å–æ–Ω–∞–∂ –∏ –§–æ–Ω</h3>
            <div class="editor-group">
                <label>–°—Å—ã–ª–∫–∞ –Ω–∞ –°–∫–æ–º–æ—Ä–æ—Ö–∞ (PNG):</label>
                <input type="text" id="edit-cupid-url" value="https://i.postimg.cc/66vncXzr/Dizajn-bez-nazvania-9.png">
            </div>
            <div class="editor-group">
                <label>–°—Å—ã–ª–∫–∞ –Ω–∞ –§–æ–Ω:</label>
                <input type="text" id="edit-bg-url" value="https://i.postimg.cc/rmvWTnyw/Dizajn-bez-nazvania-10.png">
            </div>
        </div>

        <div class="editor-section">
            <h3>2. –¢–µ–∫—Å—Ç—ã (RU)</h3>
            <div class="editor-group">
                <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫:</label>
                <input type="text" id="edit-title-ru" value="–ü—Ä–∏–≤–µ—Ç! –Ø –°–∫–æ–º–æ—Ä–æ—Ö! ü§°">
            </div>
            <div class="editor-group">
                <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                <textarea id="edit-desc-ru">–Ø —É–≥–æ—â–∞—é –≤—Å–µ—Ö –±–ª–∏–Ω–∞–º–∏! –ü–æ–º–æ–≥–∏ –º–Ω–µ –Ω–∞–∫–æ—Ä–º–∏—Ç—å –≥–æ—Å—Ç–µ–π –∏ –≤—ã—É—á–∏ Past Simple!</textarea>
            </div>
        </div>

        <div class="editor-section">
            <h3>3. –ò–≥—Ä–æ–≤—ã–µ —Ü–µ–ª–∏</h3>
            <div class="editor-group">
                <label>–û—á–∫–æ–≤ –¥–ª—è –ø–æ–±–µ–¥—ã:</label>
                <input type="number" id="edit-goal" value="3000">
            </div>
        </div>

        <div class="editor-section">
            <h3>4. –ë–∞–Ω–∫ –í–æ–ø—Ä–æ—Å–æ–≤ (JSON)</h3>
            <textarea id="edit-questions" rows="6" style="font-family: monospace; font-size: 12px;"></textarea>
        </div>

        <button class="btn" onclick="saveAndApply()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏ –ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<div id="start-screen" class="overlay">
    <div class="card">
        <h1 id="display-title">–ü—Ä–∏–≤–µ—Ç! –Ø –°–∫–æ–º–æ—Ä–æ—Ö! ü§°</h1>
        <p id="display-desc">–ü–æ–º–æ–≥–∏ –º–Ω–µ –±—Ä–æ—Å–∞—Ç—å –±–ª–∏–Ω—ã!</p>
        <button class="btn" onclick="startGame()">–ü–û–ì–ù–ê–õ–ò! ‚òÄÔ∏è</button>
    </div>
</div>

<div id="quiz-overlay" class="overlay">
    <div class="card">
        <h2 style="color: var(--primary)">–ë–ª–∏–Ω–Ω–∞—è –°–∏–ª–∞! ‚ú®</h2>
        <p id="quiz-question" style="font-size: 20px; font-weight: bold;"></p>
        <div id="options" class="options-grid" style="display: grid; gap: 10px;"></div>
    </div>
</div>

<div id="ui-layer">
    <div class="top-right">
        <button id="editor-toggle-btn" onclick="toggleEditor()">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–≥—Ä—É</button>
        <div class="indicator-box" id="wind-ui">Wind: 0</div>
    </div>
</div>

<canvas id="game-canvas"></canvas>

<script>
    const canvas = document.getElementById('game-canvas');
    const ctx = canvas.getContext('2d');

    // –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    let config = {
        cupidImg: 'https://i.postimg.cc/66vncXzr/Dizajn-bez-nazvania-9.png',
        bgImg: 'https://i.postimg.cc/rmvWTnyw/Dizajn-bez-nazvania-10.png',
        goal: 3000,
        title: "–ü—Ä–∏–≤–µ—Ç! –Ø –°–∫–æ–º–æ—Ä–æ—Ö! ü§°",
        desc: "–Ø —É–≥–æ—â–∞—é –≤—Å–µ—Ö –±–ª–∏–Ω–∞–º–∏! –ü–æ–º–æ–≥–∏ –º–Ω–µ –Ω–∞–∫–æ—Ä–º–∏—Ç—å –≥–æ—Å—Ç–µ–π –∏ –≤—ã—É—á–∏ Past Simple!",
        questions: [
            { q: "Yesterday I ___ (go) to the park.", a: ["went", "goed", "gone"], c: 0 },
            { q: "She ___ (eat) a big apple.", a: ["eated", "ate", "aten"], c: 1 },
            { q: "We ___ (see) a funny bird.", a: ["saw", "seed", "seen"], c: 0 }
        ]
    };

    let images = {}, isLoaded = false, gameState = 'START', score = 0;
    let cupid, target, note, wind = 0, mouse = { x: 0, y: 0, down: false };
    let questionPool = [];

    // –§—É–Ω–∫—Ü–∏–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
    function toggleEditor() {
        const ov = document.getElementById('editor-overlay');
        ov.style.display = (ov.style.display === 'flex') ? 'none' : 'flex';
        document.getElementById('edit-questions').value = JSON.stringify(config.questions, null, 2);
    }

    function saveAndApply() {
        config.cupidImg = document.getElementById('edit-cupid-url').value;
        config.bgImg = document.getElementById('edit-bg-url').value;
        config.title = document.getElementById('edit-title-ru').value;
        config.desc = document.getElementById('edit-desc-ru').value;
        config.goal = parseInt(document.getElementById('edit-goal').value);
        
        try {
            config.questions = JSON.parse(document.getElementById('edit-questions').value);
        } catch(e) { alert("–û—à–∏–±–∫–∞ –≤ JSON –≤–æ–ø—Ä–æ—Å–æ–≤!"); }

        updateDisplayTexts();
        loadAssets(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫–∏, –µ—Å–ª–∏ —Å—Å—ã–ª–∫–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
        toggleEditor();
    }

    function updateDisplayTexts() {
        document.getElementById('display-title').innerText = config.title;
        document.getElementById('display-desc').innerHTML = config.desc;
    }

    // –ò–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
    function loadAssets() {
        isLoaded = false;
        let urls = {
            bg: config.bgImg,
            cupid: config.cupidImg,
            p1: 'https://i.postimg.cc/VLPMHVVY/10.png',
            p2: 'https://i.postimg.cc/Hs05G9qT/2.png'
        };
        let loaded = 0;
        for(let key in urls) {
            let img = new Image();
            img.src = urls[key];
            img.onload = () => { if(++loaded === Object.keys(urls).length) { isLoaded = true; resetScene(); } };
            images[key] = img;
        }
    }

    function resetScene() {
        cupid = { x: canvas.width - 280, baseY: canvas.height / 2 - 80, y: 0, w: 130, h: 160, phase: 0 };
        note = { active: false, x: 0, y: 0, vx: 0, vy: 0 };
        wind = (Math.random() * 0.4 - 0.2);
        document.getElementById('wind-ui').innerText = "Wind: " + (wind > 0 ? "‚Üí " : "‚Üê ") + Math.abs(wind*100).toFixed(0);
        spawnTarget();
    }

    function spawnTarget() {
        target = { x: 50 + Math.random() * 200, y: canvas.height * 0.6, w: 150, h: 200, img: images.p1 };
    }

    function startGame() {
        document.getElementById('start-screen').style.display = 'none';
        gameState = 'PLAY';
        score = 0;
        questionPool = [...config.questions];
    }

    function showQuiz() {
        gameState = 'QUIZ';
        if(questionPool.length === 0) questionPool = [...config.questions];
        let qData = questionPool.pop();
        
        document.getElementById('quiz-question').innerText = qData.q;
        let optContainer = document.getElementById('options');
        optContainer.innerHTML = '';
        
        qData.a.forEach((text, i) => {
            let b = document.createElement('button');
            b.className = 'btn';
            b.style.margin = "5px";
            b.innerText = text;
            b.onclick = () => {
                if(i === qData.c) score += 200;
                document.getElementById('quiz-overlay').style.display = 'none';
                gameState = 'PLAY';
                resetScene();
            };
            optContainer.appendChild(b);
        });
        document.getElementById('quiz-overlay').style.display = 'flex';
    }

    function loop() {
        if(isLoaded && gameState === 'PLAY') {
            ctx.drawImage(images.bg, 0, 0, canvas.width, canvas.height);
            
            cupid.phase += 0.03;
            cupid.y = cupid.baseY + Math.sin(cupid.phase) * 150;
            ctx.drawImage(images.cupid, cupid.x, cupid.y, cupid.w, cupid.h);
            ctx.drawImage(target.img, target.x, target.y, target.w, target.h);

            if(note.active) {
                note.vx += wind; note.vy += 0.2;
                note.x += note.vx; note.y += note.vy;
                
                ctx.font = "40px Arial";
                ctx.fillText("ü•û", note.x, note.y);

                // –ö–æ–ª–ª–∏–∑–∏—è
                if(note.x > target.x && note.x < target.x + target.w && note.y > target.y && note.y < target.y + target.h) {
                    note.active = false;
                    score += 100;
                    setTimeout(resetScene, 500);
                } else if(note.y > canvas.height || note.x < 0) {
                    note.active = false;
                    showQuiz();
                }
            }
        }
        requestAnimationFrame(loop);
    }

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
    window.addEventListener('mousedown', (e) => {
        if(gameState !== 'PLAY' || e.target.tagName === 'BUTTON') return;
        mouse.down = true;
    });

    window.addEventListener('mouseup', (e) => {
        if(!mouse.down || note.active) return;
        mouse.down = false;
        note.active = true;
        note.x = cupid.x; note.y = cupid.y + 50;
        let angle = Math.atan2((cupid.y + 50) - e.clientY, cupid.x - e.clientX);
        let force = 18;
        note.vx = -Math.cos(angle) * force;
        note.vy = -Math.sin(angle) * force;
    });

    window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    });

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    updateDisplayTexts();
    loadAssets();
    loop();
</script>
</body>
</html>
