<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Skomorokha's Pancake Quest</title>
    <style>
        :root { --primary: #ff9800; --secondary: #fff3e0; --gold: #ffeb3b; --green: #4caf50; --red: #f44336; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Comic Sans MS', 'Arial', sans-serif; }
        canvas { display: block; touch-action: none; }
        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); display: flex;
            flex-direction: column; justify-content: center; align-items: center; z-index: 2000;
            color: white; text-align: center; padding: 20px; box-sizing: border-box;
        }
        .card {
            background: white; color: #333; padding: 30px; border-radius: 30px;
            max-width: 500px; width: 95%; border: 6px solid var(--primary);
        }
        .btn {
            background: var(--primary); color: white; border: none; padding: 15px 40px;
            font-size: 24px; font-weight: bold; border-radius: 50px; cursor: pointer;
            margin-top: 20px; transition: 0.3s; box-shadow: 0 4px 0 #e65100;
        }
        #quiz-overlay { display: none; z-index: 3000; }
        .options-grid { display: grid; gap: 10px; margin-top: 20px; width: 100%; }
        
        .opt-btn { 
            background: #fff8e1; border: 3px solid var(--secondary); padding: 15px; 
            border-radius: 15px; cursor: pointer; font-size: 20px; font-weight: bold; 
            color: #795548; transition: all 0.2s ease;
        }
        .correct { background-color: var(--green) !important; color: white !important; border-color: #2e7d32 !important; transform: scale(1.05); }
        .wrong { background-color: var(--red) !important; color: white !important; border-color: #c62828 !important; }
        .disabled { pointer-events: none; }
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; pointer-events: none; padding: 15px; box-sizing: border-box; color: white; }
        .top-left { position: absolute; top: 20px; left: 20px; }
        .top-right { position: absolute; top: 20px; right: 20px; display: flex; flex-direction: column; align-items: flex-end; gap: 10px; }
        
        #progress-bar { width: 200px; height: 20px; background: rgba(255,255,255,0.2); border-radius: 10px; border: 2px solid #fff; overflow: hidden; margin-top: 5px; }
        #progress-fill { height: 100%; width: 0%; background: var(--primary); transition: width 0.3s; }
        
        .indicator-box { background: rgba(0,0,0,0.7); padding: 8px 15px; border-radius: 20px; border: 3px solid var(--primary); font-weight: bold; font-size: 18px; }
        
        .power-bar-container { width: 140px; height: 12px; background: #444; border-radius: 6px; margin-top: 5px; border: 1px solid #fff; }
        #power-fill { width: 0%; height: 100%; background: var(--gold); border-radius: 6px; }
        #combo-msg { position: absolute; font-size: 50px; color: var(--gold); font-weight: bold; text-shadow: 3px 3px 0 #000; pointer-events: none; display: none; }
    </style>
</head>
<body>
<div id="start-screen" class="overlay">
    <div class="card">
        <h1 style="color: var(--primary); font-size: 32px;">Hi! I am Skomorokha! ü§°ü•û</h1>
        <p style="font-size: 20px;">I give pancakes to everyone! Help me throw them and learn <b>Past Simple</b>!</p>
        <button class="btn" onclick="startGame()">LET'S GO! ‚òÄÔ∏è</button>
    </div>
</div>
<div id="end-screen" class="overlay" style="display: none;">
    <div class="card">
        <h1 style="color: var(--primary); font-size: 40px;">GREAT! üåû</h1>
        <p style="font-size: 24px;">You are a Pancake Master and you know English verbs!</p>
        <button class="btn" onclick="location.reload()">PLAY AGAIN! ü•û</button>
    </div>
</div>
<div id="quiz-overlay" class="overlay">
    <div class="card">
        <h2 style="color: var(--primary); font-size: 26px;">Pancake Power! ‚ú®</h2>
        <p id="quiz-question" style="font-size: 22px; font-weight: bold; margin: 15px 0; color: #444;"></p>
        <div class="options-grid" id="options"></div>
    </div>
</div>
<div id="ui-layer">
    <div class="top-left">
        <div style="font-weight: bold; text-shadow: 1px 1px 2px #000;">Full Tummies (Goal: 3000)</div>
        <div id="progress-bar"><div id="progress-fill"></div></div>
    </div>
    <div class="top-right">
        <div class="indicator-box" id="wind-ui">Wind: 0</div>
        <div class="indicator-box">Power<div class="power-bar-container"><div id="power-fill"></div></div></div>
    </div>
</div>
<div id="combo-msg">WOW!</div>
<canvas id="game-canvas"></canvas>
<script>
    const canvas = document.getElementById('game-canvas');
    const ctx = canvas.getContext('2d');
    const grammarBank = [
        { q: "Yesterday I ___ (go) to the park.", a: ["went", "goed", "gone"], c: 0 },
        { q: "She ___ (eat) a big apple.", a: ["eated", "ate", "aten"], c: 1 },
        { q: "We ___ (see) a funny bird.", a: ["saw", "seed", "seen"], c: 0 },
        { q: "He ___ (buy) a new toy.", a: ["buyed", "bought", "boughten"], c: 1 },
        { q: "They ___ (have) a party.", a: ["haded", "has", "had"], c: 2 },
        { q: "I ___ (drink) some juice.", a: ["drank", "drunk", "drinked"], c: 0 },
        { q: "The cat ___ (sleep) on the sofa.", a: ["sleeped", "slept", "sleept"], c: 1 },
        { q: "Mom ___ (make) a cake.", a: ["maked", "made", "maden"], c: 1 },
        { q: "I ___ (write) a letter.", a: ["wrote", "writed", "written"], c: 0 },
        { q: "We ___ (swim) in the sea.", a: ["swimed", "swum", "swam"], c: 2 },
        { q: "He ___ (give) me a gift.", a: ["gived", "gave", "given"], c: 1 },
        { q: "They ___ (take) my pen.", a: ["took", "taked", "taken"], c: 0 },
        { q: "I ___ (know) the answer.", a: ["knowed", "knew", "known"], c: 1 },
        { q: "She ___ (sing) a song.", a: ["singed", "sung", "sang"], c: 2 },
        { q: "We ___ (run) very fast.", a: ["runned", "ran", "run"], c: 1 }
    ];
    let questionPool = [...grammarBank]; 
    let images = {}, isLoaded = false, score = 0, combo = 0, gameState = 'START';
    let cupid, target, note, particles = [];
    let mouse = { x: 0, y: 0, down: false };
    let wind = 0;
    function startGame() {
        document.getElementById('start-screen').style.display = 'none';
        gameState = 'PLAY';
        resetGameScene();
    }
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        if(isLoaded && gameState === 'PLAY') resetGameScene();
    }
    function resetGameScene() {
        // Skomorokha moved 2% right from previous version (from width-330 to width-300)
        cupid = { x: canvas.width - 300, baseY: canvas.height / 2 - 100, y: 0, w: 140, h: 170, phase: Math.random()*20 };
        note = { active: false, x: 0, y: 0, vx: 0, vy: 0, rot: 0 };
        spawnTarget();
        wind = (Math.random() * 0.44 - 0.22);
        document.getElementById('wind-ui').innerText = `Wind: ${wind > 0 ? '‚Üí' : '‚Üê'} ${(Math.abs(wind)*100).toFixed(0)}`;
        document.getElementById('power-fill').style.width = '0%';
    }
    function spawnTarget() {
        const url = assets.people[Math.floor(Math.random() * assets.people.length)];
        // Targets are wide (w: 160)
        target = { x: 80 + Math.random() * (canvas.width * 0.3), y: canvas.height * 0.58, w: 160, h: 210, img: images[url], hit: false };
    }
    function loop() {
        if(gameState === 'PLAY') {
            ctx.drawImage(images[assets.bg], 0, 0, canvas.width, canvas.height);
            
            cupid.phase += 0.03;
            cupid.y = cupid.baseY + Math.sin(cupid.phase) * 180;
            if(target.hit) { ctx.save(); ctx.shadowBlur = 40; ctx.shadowColor = "#ff9800"; }
            ctx.drawImage(target.img, target.x, target.y, target.w, target.h);
            ctx.restore();
            ctx.drawImage(images[assets.cupid], cupid.x, cupid.y, cupid.w, cupid.h);
            if(mouse.down && !note.active) {
                const sx = cupid.x + 20, sy = cupid.y + 70;
                const dist = Math.hypot(sx - mouse.x, sy - mouse.y);
                document.getElementById('power-fill').style.width = Math.min(100, (dist / 250) * 100) + '%';
            }
            if(note.active) {
                note.vx += wind; note.vy += 0.22; note.x += note.vx; note.y += note.vy; note.rot += 0.25;
                
                if(Math.random() > 0.5) {
                    particles.push({ x: note.x, y: note.y, vx: 0, vy: 0, life: 0.6, size: 10 + Math.random()*10, char: 'ü•û' });
                }
                ctx.save(); ctx.translate(note.x, note.y); ctx.rotate(note.rot);
                ctx.drawImage(images[assets.note], -25, -20, 50, 40);
                ctx.restore();
                const padding = 35; 
                if(note.x > target.x + padding && note.x < target.x + target.w - padding && 
                   note.y > target.y + padding && note.y < target.y + target.h - padding) {
                    target.hit = true; note.active = false; combo++;
                    score += 50; updateUI();
                    createExplosion(note.x, note.y);
                    if(combo > 1) showCombo();
                    setTimeout(resetGameScene, 800);
                } else if(note.y > canvas.height || note.x < 0 || note.x > canvas.width) {
                    note.active = false; combo = 0; showQuiz();
                }
            }
            particles.forEach((p, i) => {
                p.x += p.vx; p.y += p.vy; p.life -= 0.02;
                ctx.globalAlpha = p.life; ctx.font = p.size + 'px serif';
                ctx.fillText(p.char || 'ü•û', p.x, p.y);
                if(p.life <= 0) particles.splice(i, 1);
            });
            ctx.globalAlpha = 1;
        }
        requestAnimationFrame(loop);
    }
    function updateUI() {
        document.getElementById('progress-fill').style.width = Math.min(100, (score/3000)*100) + '%';
        if(score >= 3000) { gameState = 'END'; document.getElementById('end-screen').style.display = 'flex'; }
    }
    function createExplosion(x, y) {
        for(let i=0; i<12; i++) {
            particles.push({ 
                x, y, 
                vx:(Math.random()-0.5)*15, 
                vy:(Math.random()-0.5)*15, 
                life:1, 
                size:Math.random()*20+20,
                char: 'ü•û' 
            });
        }
    }
    function showCombo() {
        const el = document.getElementById('combo-msg');
        el.style.display = 'block'; el.style.left = target.x + 'px'; el.style.top = target.y - 50 + 'px';
        el.innerText = `COMBO x${combo}!`; setTimeout(() => el.style.display = 'none', 1000);
    }
    function showQuiz() {
        gameState = 'QUIZ';
        if (questionPool.length === 0) questionPool = [...grammarBank];
        const rIndex = Math.floor(Math.random() * questionPool.length);
        const task = questionPool.splice(rIndex, 1)[0];
        document.getElementById('quiz-question').innerText = task.q;
        const optDiv = document.getElementById('options'); 
        optDiv.innerHTML = '';
        task.a.forEach((text, i) => {
            const btn = document.createElement('button'); 
            btn.className = 'opt-btn'; 
            btn.innerText = text;
            btn.onclick = () => {
                const allBtns = document.querySelectorAll('.opt-btn');
                allBtns.forEach(b => b.classList.add('disabled'));
                if(i === task.c) {
                    btn.classList.add('correct');
                    score += 150;
                } else {
                    btn.classList.add('wrong');
                    allBtns[task.c].classList.add('correct');
                }
                setTimeout(() => {
                    updateUI(); 
                    gameState = 'PLAY'; 
                    document.getElementById('quiz-overlay').style.display = 'none'; 
                    resetGameScene();
                }, 1200); 
            };
            optDiv.appendChild(btn);
        });
        document.getElementById('quiz-overlay').style.display = 'flex';
    }
    const handleStart = (e) => { if(gameState === 'PLAY') mouse.down = true; updateMousePos(e); };
    const handleEnd = () => {
        if(mouse.down && !note.active && gameState === 'PLAY') {
            note.active = true; const sx = cupid.x + 20, sy = cupid.y + 70;
            note.x = sx; note.y = sy;
            const angle = Math.atan2(sy - mouse.y, sx - mouse.x);
            const dist = Math.hypot(sx - mouse.x, sy - mouse.y);
            const force = Math.min(26, dist / 10);
            note.vx = -Math.cos(angle) * force; note.vy = -Math.sin(angle) * force;
        }
        mouse.down = false;
        document.getElementById('power-fill').style.width = '0%';
    };
    const updateMousePos = (e) => {
        const rect = canvas.getBoundingClientRect();
        const cx = e.touches ? e.touches[0].clientX : e.clientX;
        const cy = e.touches ? e.touches[0].clientY : e.clientY;
        mouse.x = cx - rect.left; mouse.y = cy - rect.top;
    };
    window.addEventListener('mousedown', handleStart); window.addEventListener('mouseup', handleEnd);
    window.addEventListener('mousemove', updateMousePos); window.addEventListener('touchstart', handleStart);
    window.addEventListener('touchend', handleEnd); window.addEventListener('resize', resize);
    const assets = {
        bg: 'https://i.postimg.cc/rmvWTnyw/Dizajn-bez-nazvania-10.png',
        cupid: 'https://i.postimg.cc/66vncXzr/Dizajn-bez-nazvania-9.png',
        note: 'https://i.postimg.cc/WbmrRwBj/1.png',
        people: [
            'https://i.postimg.cc/VLPMHVVY/10.png', 'https://i.postimg.cc/Hs05G9qT/2.png',
            'https://i.postimg.cc/jd6NV4pY/3.png', 'https://i.postimg.cc/8PdW8m28/4.png', 
            'https://i.postimg.cc/28NvXKKr/7.png', 'https://i.postimg.cc/7Yr7QWWq/8.png',
            'https://i.postimg.cc/QxZ5nyyx/5.png', 'https://i.postimg.cc/zXwWmF9s/6.png'
        ]
    };
    function load() {
        let loaded = 0; const all = [assets.bg, assets.cupid, assets.note, ...assets.people];
        all.forEach(url => {
            const img = new Image(); img.src = url;
            img.onload = () => { if(++loaded === all.length) { isLoaded = true; resize(); loop(); } };
            images[url] = img;
        });
    }
    load();
</script>
</body>
</html>

